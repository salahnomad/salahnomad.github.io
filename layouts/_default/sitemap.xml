{{- printf "<?xml version=\"1.0\" encoding=\"utf-8\" standalone=\"yes\"?>" | safeHTML }}
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"
        xmlns:xhtml="http://www.w3.org/1999/xhtml">

  {{- $excludedPrefixes := slice "/page/" "/tags/" "/categories/" -}}

  {{- range .Site.RegularPages }}
    {{- $url := .Permalink -}}
    {{- /* Exclusion par front matter sitemap.disable */ -}}
    {{- if not .Params.sitemap.disable }}
    {{- /* Exclusion par type de page éligible */ -}}
    {{- if or (eq .Kind "page") (eq .Kind "home") (eq .Kind "section") }}
    {{- /* Exclusion par URLs contenant certains préfixes */ -}}
    {{- $exclude := false -}}
    {{- range $prefix := $excludedPrefixes }}
      {{- if in $url $prefix }}
        {{- $exclude = true -}}
      {{- end }}
    {{- end }}
    {{- if not $exclude }}
      <url>
        <loc>{{ $url }}</loc>
        {{- if not .Lastmod.IsZero }}
        <lastmod>{{ .Lastmod.Format "2006-01-02T15:04:05-07:00" | safeHTML }}</lastmod>
        {{- end }}
        {{- with .Sitemap.ChangeFreq }}
        <changefreq>{{ . }}</changefreq>
        {{- else }}
        <changefreq>weekly</changefreq>
        {{- end }}
        {{- with .Sitemap.Priority }}
        <priority>{{ . }}</priority>
        {{- else }}
        <priority>0.5</priority>
        {{- end }}
      </url>
    {{- end }}
    {{- end }}
    {{- end }}
  {{- end }}

</urlset>
